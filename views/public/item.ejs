<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= item.name %> // Free Templates</title>
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
</head>
<body class="bg-slate-200 text-slate-900 font-mono">
    <div class="flex min-h-screen">
        
        <%- include('../partials/public/sidebar') %>

        <div class="flex-1 flex flex-col">
            
            <%- include('../partials/public/header') %>

            <main class="p-4 md:p-8">
                <div class="mb-6 text-sm font-bold uppercase flex gap-2 items-center flex-wrap">
                    <a href="/" class="hover:text-cyan-500"><i class="fa-solid fa-house"></i></a>
                    <span class="text-slate-400">/</span>
                    
                    <% if (currentCategory) { %>
                        <a href="/category/<%= currentCategory.slug %>" class="hover:text-cyan-500"><%= currentCategory.name %></a>
                    <% } else { %>
                        <span class="text-slate-500">Uncategorized</span>
                    <% } %>
                    
                    <span class="text-slate-400">/</span>
                    <span class="text-fuchsia-600 truncate max-w-[200px]"><%= item.name %></span>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 lg:gap-12">
                    
                    <div class="lg:col-span-3">
                        
                        <div class="bg-white border-2 border-slate-900 brutalist-shadow-dark mb-8">
                            
                            <div class="h-9 bg-slate-100 border-b-2 border-slate-900 flex items-center px-3 gap-2">
                                <div class="w-3 h-3 rounded-full bg-red-400 border-2 border-slate-900"></div>
                                <div class="w-3 h-3 rounded-full bg-amber-400 border-2 border-slate-900"></div>
                                <div class="w-3 h-3 rounded-full bg-green-400 border-2 border-slate-900"></div>
                                <div class="flex-1 h-5 bg-white border-2 border-slate-900 rounded-sm ml-2 flex items-center px-2">
                                    <span class="text-[10px] text-slate-400 font-bold truncate">template://<%= item.slug %></span>
                                </div>
                            </div>

                            <div class="w-full bg-slate-50 flex items-center justify-center overflow-hidden">
                                <% if (item.images && item.images.length > 0) { %>
                                    <img src="<%= item.images[0] %>" alt="Main Preview" class="w-full h-auto object-cover object-top" id="main-image">
                                <% } else { %>
                                    <div class="w-full h-96 flex items-center justify-center">
                                        <span class="text-slate-400 font-bold uppercase">No Preview Available</span>
                                    </div>
                                <% } %>
                            </div>
                        </div>

                        <% if (item.images && item.images.length > 1) { %>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <% item.images.forEach((img, index) => { %>
                                    <a href="<%= img %>" class="thumb-trigger block border-2 border-slate-900 bg-white p-1 hover:border-cyan-400 transition-colors">
                                        <img src="<%= img %>" alt="View <%= index + 1 %>" class="w-full h-24 object-cover hover:opacity-75 transition-opacity">
                                    </a>
                                <% }) %>
                            </div>
                        <% } %>
                    </div>

                    <div class="lg:col-span-2 flex flex-col gap-6">
                        <div>
                            <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 uppercase leading-tight">
                                <%= item.name %>
                            </h1>
                            
                            <% if (item.title && item.title !== item.name) { %>
                                <h2 class="text-xl md:text-2xl text-slate-500 font-bold uppercase mt-2"><%= item.title %></h2>
                            <% } %>
                            
                            <div class="flex flex-wrap items-start gap-3 mt-6">
                                <% if (currentCategory) { %>
                                    <a href="/category/<%= currentCategory.slug %>" class="group flex items-center gap-2 border-2 border-slate-900 bg-white px-3 py-1.5 hover:bg-slate-50 transition-colors shadow-sm">
                                        <i class="<%= currentCategory.icon %> text-fuchsia-600 group-hover:scale-110 transition-transform"></i>
                                        <span class="font-bold uppercase text-sm"><%= currentCategory.name %></span>
                                    </a>
                                <% } else { %>
                                     <span class="flex items-center gap-2 border-2 border-slate-900 bg-slate-100 px-3 py-1.5 text-slate-500">
                                        <i class="fa-solid fa-folder-open"></i>
                                        <span class="font-bold uppercase text-sm">Uncategorized</span>
                                    </span>
                                <% } %>

                                <% if (item.tags && item.tags.length > 0) { %>
                                    <% item.tags.forEach(tag => { %>
                                        <a href="/tag/<%= tag %>" class="flex items-center gap-2 border-2 border-slate-900 bg-lime-300 px-3 py-1.5 hover:bg-lime-400 transition-colors text-slate-900 shadow-sm">
                                            <i class="fa-solid fa-hashtag text-xs"></i>
                                            <span class="font-bold uppercase text-sm"><%= tag %></span>
                                        </a>
                                    <% }) %>
                                <% } %>
                            </div>
                        </div>

                        <% if (item.filePath) { %>
                            <a href="/item/<%= item.slug %>/download" class="flex items-center justify-center gap-4 w-full text-center bg-fuchsia-500 text-white px-8 py-4 border-2 border-slate-900 font-bold hover:bg-fuchsia-600 transition-all hover:translate-x-1 hover:translate-y-1 brutalist-shadow-dark hover:shadow-none uppercase text-xl">
                                <i class="fa-solid fa-download"></i>
                                <span>Download Now</span>
                            </a>
                        <% } else { %>
                            <button disabled class="flex items-center justify-center gap-4 w-full text-center bg-slate-300 text-slate-500 px-8 py-4 border-2 border-slate-500 font-bold uppercase text-xl cursor-not-allowed">
                                <i class="fa-solid fa-ban"></i>
                                <span>Unavailable</span>
                            </button>
                        <% } %>

                        <div class="bg-slate-100 border-2 border-slate-900 p-4 flex items-center gap-4">
                            <i class="fa-solid fa-hand-holding-dollar text-2xl text-cyan-500"></i>
                            <p class="font-bold text-sm">
                                This template is completely free for personal and commercial use. No attribution required.
                            </p>
                        </div>

                        <div class="prose prose-slate font-mono prose-headings:uppercase prose-headings:font-extrabold prose-a:text-fuchsia-600">
                            <%- markdown(item.content) %>
                        </div>
                        
                        <% 
                            const isHtml = item.filePath && item.filePath.endsWith('.html');
                        %>

                        <div class="mt-4">
                            <% if (isHtml) { %>
                                <a href="/item/<%= item.slug %>/preview" target="_blank" class="inline-flex items-center gap-2 font-bold uppercase hover:text-cyan-500 border-b-2 border-slate-900 pb-1">
                                    <i class="fa-solid fa-desktop"></i> Live Preview
                                </a>
                            <% } else if (item.externalLink) { %>
                                <a href="<%= item.externalLink %>" target="_blank" class="inline-flex items-center gap-2 font-bold uppercase hover:text-cyan-500 border-b-2 border-slate-900 pb-1">
                                    <i class="fa-solid fa-external-link-alt"></i> External Preview
                                </a>
                            <% } %>
                        </div>
                    </div>
                </div>
            </main>

            <%- include('../partials/public/footer') %>
        </div>
    </div>

    <script>
        document.querySelectorAll('.thumb-trigger').forEach(thumb => {
            thumb.addEventListener('click', (e) => {
                e.preventDefault(); 
                const main = document.getElementById('main-image');
                if(main) main.src = thumb.getAttribute('href');
            });
        });
    </script>
</body>
</html>
